<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Picture: The Urchin Barrens Trophic Cascade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .flow-arrow {
            width: 2px;
            background-color: #FF851B; /* Orange for flow */
            height: 40px;
            margin: 0 auto;
        }
        .flow-arrow::after {
            content: ' ';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: #FF851B transparent transparent transparent;
        }
        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-300 to-blue-500 min-h-screen text-gray-800 flex items-center justify-center py-12 px-4">

    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-5xl w-full">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-[#0074D9] mb-4">Rich Picture: The Urchin Barrens Trophic Cascade</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">This visualization illustrates how interconnected ecological factors, exacerbated by climate change, can lead to the dramatic transformation of thriving kelp forests into barren underwater landscapes.</p>
        </header>

        <div class="flex flex-col items-center space-y-8">

            <!-- Step 1: Climate Stress & Disease -->
            <div class="relative bg-[#FF4136] text-white p-6 rounded-lg shadow-xl w-full max-w-md text-center border-2 border-red-600">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-[#FF4136] px-4 py-1 rounded-full text-sm font-semibold shadow-md">Step 1</div>
                <div class="text-6xl mb-4">üå°Ô∏èü¶†</div>
                <h3 class="text-2xl font-bold mb-2">Climate Stress & Disease</h3>
                <p class="text-sm">Marine heatwaves and environmental changes weaken ecosystems, making them vulnerable to diseases. For example, sea stars, key predators, suffer massive die-offs from sea star wasting disease.</p>
                <button data-step="climateStress" class="learn-more-btn mt-4 bg-red-800 text-white py-2 px-4 rounded-full shadow-md hover:bg-red-900 transition-colors">‚ú® Learn More ‚ú®</button>
                <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 flow-arrow"></div>
            </div>

            <!-- Step 2: Predator Loss -->
            <div class="relative bg-[#FF851B] text-white p-6 rounded-lg shadow-xl w-full max-w-md text-center border-2 border-orange-600">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-[#FF851B] px-4 py-1 rounded-full text-sm font-semibold shadow-md">Step 2</div>
                <div class="text-6xl mb-4">ü¶Äü¶û</div>
                <h3 class="text-2xl font-bold mb-2">Predator Loss</h3>
                <p class="text-sm">With the decline of sea stars and other natural predators (like lobsters and California sheephead) due to disease or overfishing, the ecological balance is disrupted.</p>
                <button data-step="predatorLoss" class="learn-more-btn mt-4 bg-orange-800 text-white py-2 px-4 rounded-full shadow-md hover:bg-orange-900 transition-colors">‚ú® Learn More ‚ú®</button>
                 <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 flow-arrow"></div>
            </div>

            <!-- Step 3: Urchin Population Boom -->
            <div class="relative bg-[#800080] text-white p-6 rounded-lg shadow-xl w-full max-w-md text-center border-2 border-purple-600">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-[#800080] px-4 py-1 rounded-full text-sm font-semibold shadow-md">Step 3</div>
                <div class="text-6xl mb-4">üíúüíúüíú</div>
                <h3 class="text-2xl font-bold mb-2">Urchin Population Boom</h3>
                <p class="text-sm">Without predators to keep them in check, voracious grazers like purple sea urchins multiply unchecked, forming dense aggregations that consume everything in their path.</p>
                <button data-step="urchinBoom" class="learn-more-btn mt-4 bg-purple-800 text-white py-2 px-4 rounded-full shadow-md hover:bg-purple-900 transition-colors">‚ú® Learn More ‚ú®</button>
                 <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 flow-arrow"></div>
            </div>

            <!-- Step 4: Urchin Barren Forms -->
            <div class="relative bg-gray-700 text-white p-6 rounded-lg shadow-xl w-full max-w-md text-center border-2 border-gray-900">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-gray-700 px-4 py-1 rounded-full text-sm font-semibold shadow-md">Step 4</div>
                <div class="text-6xl mb-4">üíÄüåø</div>
                <h3 class="text-2xl font-bold mb-2">Urchin Barren Forms</h3>
                <p class="text-sm">The unchecked urchin populations overgraze the kelp forests, devastating the ecosystem and transforming lush, productive habitats into barren, rocky seafloors, severely impacting biodiversity.</p>
                <button data-step="urchinBarren" class="learn-more-btn mt-4 bg-gray-800 text-white py-2 px-4 rounded-full shadow-md hover:bg-gray-900 transition-colors">‚ú® Learn More ‚ú®</button>
            </div>

        </div>

        <footer class="text-center mt-12 text-gray-600 text-sm">
            <p>This rich picture highlights the cascading impacts within marine ecosystems.</p>
            <p>Understanding these connections is vital for effective conservation and climate action.</p>
        </footer>
    </div>

    <!-- The Modal -->
    <div id="responseModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modalTitle" class="text-xl font-bold mb-4 text-[#0074D9]"></h3>
            <p id="modalContent" class="text-gray-700"></p>
            <div id="modalLoading" class="text-center text-gray-500 mt-4 hidden">Loading...</div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('responseModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const modalLoading = document.getElementById('modalLoading');
        const closeButton = document.getElementsByClassName('close-button')[0];

        // Close modal when 'x' is clicked
        closeButton.onclick = function() {
            modal.style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        async function callGeminiAPI(prompt, title) {
            modal.style.display = 'flex';
            modalTitle.textContent = title;
            modalContent.textContent = '';
            modalLoading.classList.remove('hidden');

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    modalContent.textContent = text;
                } else {
                    modalContent.textContent = "Sorry, I couldn't generate a response. Please try again.";
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                modalContent.textContent = "An error occurred while fetching the response. Please check the console.";
            } finally {
                modalLoading.classList.add('hidden');
            }
        }

        document.querySelectorAll('.learn-more-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const step = event.target.dataset.step;
                let prompt = '';
                let title = '';

                switch (step) {
                    case 'climateStress':
                        title = '‚ú® Climate Stress & Disease Explained ‚ú®';
                        prompt = 'Explain in detail how marine heatwaves and climate stress can lead to increased disease susceptibility and die-offs in key marine species like sea stars, impacting ecosystems.';
                        break;
                    case 'predatorLoss':
                        title = '‚ú® Predator Loss Explained ‚ú®';
                        prompt = 'Elaborate on how the decline of key predators (e.g., sea stars, lobsters, California sheephead) due to disease or other environmental factors affects the balance of marine ecosystems, specifically in kelp forests.';
                        break;
                    case 'urchinBoom':
                        title = '‚ú® Urchin Population Boom Explained ‚ú®';
                        prompt = 'Describe why the population of grazers like purple sea urchins can explode when their natural predators are removed or significantly reduced, and what impact this has initially on their environment.';
                        break;
                    case 'urchinBarren':
                        title = '‚ú® Urchin Barren Forms Explained ‚ú®';
                        prompt = 'Explain the final stage of the trophic cascade, where unchecked sea urchin populations overgraze kelp forests, leading to "urchin barrens" and the complete devastation of the underwater ecosystem.';
                        break;
                    default:
                        title = 'Information';
                        prompt = 'No specific information available for this step.';
                }
                callGeminiAPI(prompt, title);
            });
        });
    </script>
</body>
</html>
